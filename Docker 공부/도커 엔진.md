# 도커 엔진

## 1. 도커 이미지와 컨테이너
도커 엔진에서 사용하는 기본 단위는 ***이미지와 컨테이너이***며 이 두가지가 핵심입니다.

### 1.1. 도커 이미지
* 이미지란 ***컨테이너를 생성할 때*** 필요한 요소이며, 가상 머신을 생성할 때 사용하는 iso 파일과 비슷한 개념입니다.
* 여러 개의 계층으로 된 바이너리 파일로 존재하고, 컨테이너를 생성하고 실행할 때 ***읽기 전용***으로 사용됩니다.

### 1.2. 도커 컨테이너
* 이미지로 컨테이너를 생성하면 해당 이미지의 목적에 맞는 파일이 들어 있는 파일시스템과 ***격리된 시스템 자원 및 네트워크를 사용할 수 있는 독립된 공간이 생성되고, 이것이 도커 컨테이너가 됩니다.*** (23p - 이미지)
* 컨테이너는 이미지를 읽기 전용으로 사용하되 이미지에서 변경된 사항만 컨테이너 계증에 저장하므로 컨테이너에서 무엇을 하든지 원래 이미지는 영향을 받지 않습니다.

## 2. 도커 컨테이너 다루기

### 2.1. 컨테이너 생성
1. docker run -i -t ubuntu:14.04   
    * -i -t 옵션은 컨테이너와 상호 입출력을 가능하게 합니다.
    * -i 옵션으로 상호 입출력
    * -t 옵션으로 tty를 활성화해서 배시(bash) 셸을 사용하도록 컨테이너를 설정

2. run을 사용하지 않고 컨테이너를 생성해 봅시다.
    * docker pull "이미지 주소" - 사용할 이미지를 내려받습니다.
    * docker images - 이미지를 정상적으로 내려받았는지 확인해봅니다.
    * docker create -i -t --name "container 이름" "사용할 이미지"   
    => docker create -i -t --name mycentos centos:7     
    => 이번에는 run 명령어를 실행했을 때와 달리 컨테이너 내부로 들어가지 않습니다.  
    create 명령어는 컨테이너를 생성만 할 뿐 컨테이너로 들어가지 않기 때문입니다.
    * docker start "container 이름" - container를 실행합니다.
    * docker attach "container 이름" - container 내부로 들어갑니다.

3. run vs create
    * run 명령어는 pull, create, start 명령어를 일괄적으로 실행한 후 attach가 가능한 컨테이너라면 컨테이너 내부로 들어갑니다.

### 2.2. 컨테이너 목록 확인
1. docker ps -> 정지되지 않은 컨테이너만 출력합니다.
2. docker ps -a -> 모든 컨테이너를 출력합니다.

### 2.3. 컨테이너 삭제
1. docker rm "container 이름"
    * 실행 중인 컨테이너는 삭제할 수 없기 때문에 멈추고 삭제해야 합니다.
    * docker stop "container 이름"
    * docker rm "container 이름"
    * 또는 docker rm -f "container 이름"을 사용해도 됩니다.

2. docker container prune 명령어는 모든 컨테이너를 삭제합니다.

### 2.4. 컨테이너를 외부에 노출
**컨테이너는 가상 머신과 마찬가지로 가상 IP 주소를 할당받습니다. 기본적으로 도커는 컨테이너에 172.17.0.x의 IP를 순차적으로 할당합니다.**
외부에 컨테이너의 애플리케이션을 노출하기 위해서는 eth0의 IP와 포트를 호스트의 IP와 포트에 바인딩해야 합니다.
1. docker run -i -t --name "container 이름" ***-p 80:80*** "이미지 이름"
    * -p 옵션은 컨테이너의 포트를 호스트의 포트와 바인딩해 연결할 수 있게 설정합니다.
    * [호스트의 포트]:[컨테이너의 포트]
    * 호스트의 특정 IP를 사용하려면 192.168.0.100:7777:80과 같이 바인딩할 IP와 포트를 명시합니다. 또한 여러개의 포트를 외부에 개방하려면 -p 옵션을 여러 번 써서 설정합니다.

***(33p) 호스트의 IP와 포트를 컨테이너의 IP와 포트로 연결한다는 개념은 매우 중요합니다. 아파치 웹 서버는 172 대역을 가진 컨테이너의 NAT IP와 80번 포트로 서비스하므로 여기에 접근하려면 172.17.0.x:80의 주소로 접근해야 합니다. 그러나 도커의 포트 포워딩 옵션인 -p를 써서 호스트와 컨테이너를 연결했으므로 호스트의 IP와 포트를 통해 172.17.0.x:80으로 접근할 수 있습니다.***

### 2.5. 컨테이너 애플리케이션 구축
